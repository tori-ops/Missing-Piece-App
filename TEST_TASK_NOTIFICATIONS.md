#!/bin/bash
# Test script for task notification system
# This script helps verify that the task notification system is working correctly

echo "=== Task Notification System Test Guide ==="
echo ""
echo "Prerequisites:"
echo "- Both tenant and client users must be set up"
echo "- Application must be running"
echo ""
echo "Test Steps:"
echo ""
echo "1. CREATE A TASK WITH ASSIGNMENT"
echo "   - Log in as TENANT"
echo "   - Open Tasks modal"
echo "   - Create a new task"
echo "   - Assign to a CLIENT user"
echo "   - Verify notification badge appears on Tasks icon"
echo ""
echo "2. CHECK NOTIFICATION COUNT"
echo "   - Verify Tasks widget shows badge with count"
echo "   - Check badge refreshes every 30 seconds"
echo ""
echo "3. VERIFY CLIENT SEES NOTIFICATION"
echo "   - Log in as the assigned CLIENT user"
echo "   - Task icon should show notification badge"
echo "   - Unread count should match"
echo ""
echo "4. TEST TASK COMPLETION CLEANUP"
echo "   - Change task status to COMPLETED"
echo "   - Notification should be automatically deleted by trigger"
echo "   - Badge count should decrease"
echo ""
echo "5. TEST TASK REASSIGNMENT"
echo "   - Edit task and reassign to different user"
echo "   - Old notification should be removed"
echo "   - New notification should be created for new assignee"
echo ""
echo "6. TEST CHANGED_MIND STATUS"
echo "   - Change task status to CHANGED_MIND"
echo "   - Notification should be automatically deleted"
echo "   - Badge should update"
echo ""
echo "Database Queries to Verify:"
echo ""
echo "-- Check if notifications table exists"
echo "SELECT COUNT(*) FROM task_notifications;"
echo ""
echo "-- Get all notifications for a user"
echo "SELECT * FROM task_notifications WHERE user_id = '{user_id}';"
echo ""
echo "-- Check if trigger is working"
echo "SELECT COUNT(*) FROM task_notifications WHERE task_id = '{task_id}';"
echo ""
echo "Expected Results:"
echo "- TaskNotification records created when task assigned"
echo "- Unread count accessible via /api/tasks/notifications/unread"
echo "- Notifications auto-deleted when status = CHANGED_MIND or COMPLETED"
echo "- Badge counts update in real-time (or every 30 seconds)"
echo "- Both client and tenant notifications created when assigned to both"
echo ""
